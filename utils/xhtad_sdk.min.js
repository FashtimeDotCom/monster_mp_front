"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};!function(n,t){"object"==(typeof exports==="undefined"?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.app=t();}(undefined,function(){var g=require("./xhtad_conf.js"),h=require("./xhtad_md5.js"),lk="https://log.xiaohutui.com",i=0,j={};if(!g.app_key||22!==g.app_key.length){console.warn("\u5C0F\u4E92\u63A8\u63D0\u793A\uFF1A\u914D\u7F6E\u9519\u8BEF\uFF0C\u8BF7\u5728xhtadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6E\u60A8\u7684app_key\u3002");}var c,t=App,o=Page,m={ak:g.app_key.replace(/(^\s*)|(\s*$)/g,""),v:'2.12',debug:g.debug?g.debug:false,adtype:"",reqid:"",pb:"",pm:"",sv:"",pv:"",nt:"",ww:0,wh:0,pr:0,long:0,lat:0,wvv:"",wv:"",lang:"",wsr:{},pp:"",uuid:"",drop:{hasCollect:!1,hasSell:!1},user_info:{}},n=0,edata='',p=function p(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1);}var b;try{if(b=wx.getStorageSync("xhtaduuid"),b)return b;}catch(a){}b=a()+a()+a()+a()+a()+a()+a()+a();try{wx.setStorageSync("xhtaduuid",b);}catch(a){}return b;},s=function s(a){function b(){4===c.length&&(n=1,a&&a());}var c=[];(function(){wx.getSetting({success:function success(a){a.authSetting["scope.userInfo"]?wx.getUserInfo({withCredentials:!1,success:function success(a){m.user_info=a.userInfo;},complete:function complete(){c.push("ok1"),b();}}):(c.push("ok1"),b());},fail:function fail(){c.push("ok1"),b();}});})(),function(){wx.getSystemInfo({success:function success(a){m.wv="undefined"==typeof a.SDKVersion?"1.0.0":a.SDKVersion,m.pb=a.brand,m.pm=a.model,m.pr=a.pixelRatio,m.ww=a.screenWidth,m.wh=a.screenHeight,m.lang=a.language,m.wvv=a.version,m.sv=a.system,m.pv=a.platform;},complete:function complete(){c.push("ok2"),b();}});}(),function(){wx.getSetting({success:function success(a){a.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function success(a){m.long=a.latitude,m.lat=a.longitude;},complete:function complete(){c.push("ok3"),b();}}):(c.push("ok3"),b());},fail:function fail(){c.push("ok3"),b();}});}(),function(){wx.getNetworkType({success:function success(a){m.nt=a.networkType;},complete:function complete(){c.push("ok4"),b();}});}();},E=function E(n,t,e){if(n[t]){var o=n[t];n[t]=function(n){o.call(this,n),e.call(this,n,t);};}else n[t]=function(n){e.call(this,n,t);};},tt=function tt(a){return 1===a?{dTag:"xht_banner",dClass:"banner_style"}:2===a?{dTag:"xht_insert",dClass:"screen_style"}:4===a?{dTag:"xht_fixed",dClass:"fixed_style"}:void 0;},u=function u(a,b){void v(b,["stat/getad"],function(d){if(0==d.data.errcode){if(parseFloat(m.v)<parseFloat(d.data.version)){console.warn("发现v"+d.data.version+"版小虎推SDK，当前版本v"+m.v+"，请尽快升级！");}var e=d.data;j[b]=e,j[b].hasshow=!0,j[b].id=b,j[b].push=0,j[b].encdata={'encdata':j[b].encdata};var f=tt(e.adtype);if(f){j[b].style=H[f.dClass];var g=a.data.xhtad;g.adData=j,c?a.xhtapply(j):a.setData({xhtad:g});}}else;});},v=function v(a,b,c,d){0===n?s(function(){w(a,c,b,d);}):w(a,c,b,d);},w=function w(a,b,c,d){var d=d?"get":"post",e=lk+"/log/";if(m.adtype=a,m.uuid=m.uuid||o(),"log"!=c[0]){var f=Date.now()+m.ak+m.uuid+m.adtype;m.reqid=h.hexMD5(f);}var g=0,i=function a(){wx.request({url:e+c[0],data:m,header:{},method:d,success:function success(a){b(a);},fail:function fail(){2>g&&(g++,m.retryTimes=g,setTimeout(function(){a();},1e3));}});};i();},I=function I(n){this.app=n;},x=function x(n){this.xhtad=new I(this),I.prototype.getxhtAds=function(n,t){v(n,["stat/getad"],function(d){if(!d.data.errcode){if(parseFloat(m.v)<parseFloat(d.data.version)){console.warn("发现v"+d.data.version+"版小虎推SDK，当前版本v"+m.v+"，请尽快升级！");return false;}var xht_adv=wx.getStorageSync('xht_adv')?wx.getStorageSync('xht_adv'):{};xht_adv[n]=d.data;wx.setStorageSync('xht_adv',xht_adv);A(d.data.ikey,"stat/imp",function(){},"get");var adData={};if(d.data.show_type!=1){adData={errcode:0,data:{appId:d.data.to_appid,img:d.data.pic}};}else{adData={errcode:0,data:{appId:d.data.to_appid,name:d.data.name,desc:d.data.desc,img:d.data.pic}};}}else{adData={errcode:1,data:{}};}t(adData);});},I.prototype.xhtAdsClk=function(k){cli(k);},m.uuid=p(),sa(n);},cli=function cli(a){var xht_adv=wx.getStorageSync('xht_adv')[a],d=xht_adv.ckey;var e=xht_adv.jump_type;switch(e){case 1:{xht_adv.adImgUrl||(xht_adv.adImgUrl=xht_adv.to_qr),wx.previewImage({current:xht_adv.adImgUrl,urls:[xht_adv.adImgUrl],success:function success(){A(d,"stat/cli",function(){},"get");}});break;}case 2:{wx.navigateToMiniProgram({appId:xht_adv.to_appid,extraData:{encdata:xht_adv.encdata},path:xht_adv.load_page,envVersion:'release',success:function success(){A(d,"stat/cli",function(){},"get");}});break;}default:{console.error("SDK\u9519\u8BEF\uFF1A\u8DF3\u8F6C\u7C7B\u578B\u4E3A\uFF1A"+e+" \uFF0C\u4E0D\u662F\u7EA6\u5B9A\u7684\u7C7B\u578B\u3002\u65E0\u6CD5\u8FDB\u884C\u8DF3\u8F6C\u3001\u70B9\u51FB\u4E0A\u62A5\uFF0C\u8054\u7CFBGO\u5DE5\u7A0B\u5E08\uFF01\uFF01\uFF01");break;}}},sp=function sp(t){var e=t.split("&"),n={};for(var u in e){e[u]=e[u].split("="),n[e[u][0]]=e[u][1];}return n;},cka=function cka(s){wx.getSetting({success:function success(res){if(!res.authSetting['scope.userInfo']){setTimeout(function(){wx.getSetting({success:function success(res){if(res.authSetting['scope.userInfo']){var _time=Date.parse(new Date())/1000;var dk=h.hexMD5(m.ak+m.uuid+_time);wx.getUserInfo({success:function success(info){if(!edata)return false;wx.request({url:lk+'/auth',method:"POST",data:{d_key:dk,time:_time,encdata:edata,uuid:m.uuid,user_info:info.userInfo},success:function success(){}});}});}else{cka(s);}}});},6000);}}});},sa=function sa(s){edata=s.scene==1037?(s.referrerInfo.extraData||{}).encdata:sp(decodeURIComponent(s.query.scene)).encdata;wx.login({success:function success(res){var b={jscode:encodeURIComponent(res.code),uuid:m.uuid,appkey:m.ak,encdata:edata},c=lk+"/log/";wx.request({url:c+"stat/init",method:"post",data:b});},fail:function fail(){}}),cka(s);},A=function A(a,b){var c=c?"get":"post",d=lk+"/log/",e={key:a};var f=0;(function a(){wx.request({url:d+b,data:e,method:c?"post":"get",success:function success(){},fail:function fail(){2>f&&(f++,e.retryTimes=f,setTimeout(function(){a();},1e3));}});})();},B=function B(a){var b=a.currentTarget.dataset.id,c=j[b];if(0===c.push){var d=c.ikey;if(1===c.adtype){var e=this,f=wx.createIntersectionObserver(e,{thresholds:[.2],selectAll:!0});f.relativeToViewport().observe(".xht_banner",function(a){if(.2<a.intersectionRatio){var c=e.data.xhtad;c.adData[b].push=1,e.setData({xhtad:c}),A(d,"stat/imp",function(){},"get"),f.disconnect();}});}else A(d,"stat/imp",function(){},"get");}},C=function C(a){var b=a.currentTarget.dataset.id,c=this.data.xhtad;c.adData[b].hasshow=!1,this.setData({xhtad:c});},D=function D(a){var b=a.currentTarget.dataset.id,d=j[b].ckey;var e=j[b].jump_type;switch(e){case 1:{a.currentTarget.dataset.adImgUrl||(a.currentTarget.dataset.adImgUrl=j[b].to_qr),wx.previewImage({current:a.currentTarget.dataset.adImgUrl,urls:[a.currentTarget.dataset.adImgUrl],success:function success(){A(d,"stat/cli",function(){},"get");}});break;}case 2:{A(d,"stat/cli",function(){},"get");break;}default:{console.error("SDK\u9519\u8BEF\uFF1A\u8DF3\u8F6C\u7C7B\u578B\u4E3A\uFF1A"+e+" \uFF0C\u4E0D\u662F\u7EA6\u5B9A\u7684\u7C7B\u578B\u3002\u65E0\u6CD5\u8FDB\u884C\u8DF3\u8F6C\u3001\u70B9\u51FB\u4E0A\u62A5\uFF0C\u8054\u7CFBGO\u5DE5\u7A0B\u5E08\uFF01\uFF01\uFF01");break;}}},y=function y(){m.wsr=wx.getStorageSync("xhtwsr"),m.pp=this.route;var a;try{a=this.data.xhtad.ad;}catch(a){}if(a){var b=this;for(var c in a){if(a[c])u(b,c);}}},z=function z(){var a=this.options.xhtadH5url;a&&(a=a.replace("|","?").replace("$","="),this.setData({xhtadURL:a}));},H={banner_style:{wrap:"position: relative; display: flex; width: 100%; overflow: hidden",img:"width: 100%; margin: 0 auto;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"},screen_style:{wrap:"position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, .3); z-index: 9999;",content:"position: relative; display: flex; width: 600rpx !important; overflow: hidden; left: calc(50% - 300rpx); top: calc(50% - 250rpx)",img:"width: 100%;",close:"position: absolute; top: 0; right: 0; width: 34rpx !important; height: 34rpx !important; padding: 10rpx; z-index: 2",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;",icon:"position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;"},fixed_style:{wrap:"position: fixed; display: flex; width: 120rpx !important; right: 60rpx; bottom: 60rpx; z-index: 9998;",img:"width: 100%;border-radius:50%",nav:"position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;"}};;App=function App(n){E(n,"onLaunch",x),t(n);},Page=function Page(n){E(n,"onLoad",y),E(n,"onShow",z),E(n,"xhtadClose",C),E(n,"xhtadImgLoad",B),E(n,"xhtappoIntView",D),o(n);};});